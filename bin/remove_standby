#!/bin/bash
#/////////////////////////////////////////////////////////////////////////////////////
# nanohome - remove standby
#
# Disable standbymanager for a device
#/////////////////////////////////////////////////////////////////////////////////////
DESCRIPTION=$1

# Define subscribe topic: "nanohome/standby/?"
STANDBYTOPIC="nanohome/standby/${DESCRIPTION}/"

# Kill standby manager for device
PID=$(ps | grep "${STANDBYTOPIC}" | grep -v "grep" | awk '{print $1}')
[[ -n "${PID}" ]] && kill -9 "${PID}"
PID=$(ps | grep "${STANDBYTOPIC}" | grep -v "grep" | awk '{print $1}')

if [[ -z $PID ]]; then
    echo -e "${LOG_SUCC} Nanohome: Standbymanager for \"${DESCRIPTION}\" terminated" >> /proc/1/fd/1
else 
    echo -e "${LOG_ERRO} Nanohome: Could not terminate standbymanager for \"${DESCRIPTION}\"" >> /proc/1/fd/1
    echo -e "${LOG_ERRO}  > PID: ${PID}" >> /proc/1/fd/1
fi